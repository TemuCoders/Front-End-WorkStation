@if (editedUser(); as user) {
  <div class="layout">

    <app-sidebar></app-sidebar>

    <div class="main">

      <section class="profile-edit-layout">

        <!-- PROFILE CARD -->
        <article class="profile-card">
          <div class="profile-cover">
            <img
              class="cover-img"
              [src]="avatarUrl(user)"
              alt="Cover"
            />
          </div>

          <div class="profile-avatar-wrapper">
            <img
              class="profile-avatar"
              [src]="avatarUrl(user)"
              alt="Avatar"
            />
          </div>

          <div class="profile-info">
            <h2 class="profile-name">{{ user.name || '(sin nombre)' }}</h2>
            <p class="profile-username">@{{ firstName(user.name) | lowercase }}</p>

            <div class="profile-details">
              <span class="profile-role" [ngClass]="user.role.roleName | lowercase">
                {{ user.role.roleName }}
              </span>
              <span class="profile-age">{{ user.age }} años</span>
              <span class="profile-location">{{ user.location || 'Ubicación desconocida' }}</span>
            </div>

            <p class="profile-quote">
              {{ user.location || '"I like the way you work it"' }}
            </p>

            <p class="profile-register">Registrado desde: {{ user.registerDate | date:'mediumDate' }}</p>
          </div>
        </article>

        <!-- PROFILE EDIT FORM -->
        <article class="profile-edit-card">
          <h3 class="form-title">Editar Perfil</h3>

          <form class="profile-form" (ngSubmit)="save()">
            <div class="form-grid">
              <mat-form-field appearance="outline" class="field field-full">
                <mat-label>Nombre</mat-label>
                <input
                  matInput
                  [value]="user.name"
                  (input)="onFieldChange('name', $any($event.target).value)"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="field">
                <mat-label>Edad</mat-label>
                <input
                  matInput
                  type="number"
                  [value]="user.age"
                  (input)="onFieldChange('age', +$any($event.target).value)"
                  min="0"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="field field-full">
                <mat-label>Ubicación</mat-label>
                <input
                  matInput
                  [value]="user.location"
                  (input)="onFieldChange('location', $any($event.target).value)"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="field field-full">
                <mat-label>Foto (URL)</mat-label>
                <input
                  matInput
                  [value]="user.photo"
                  (input)="onFieldChange('photo', $any($event.target).value)"
                />
              </mat-form-field>
            </div>


            <div class="form-actions">
              <button mat-flat-button color="primary" type="submit">
                Actualizar
              </button>
              <button
                mat-stroked-button
                type="button"
                (click)="delete()"
                [disabled]="!user.id"
              >
                Eliminar
              </button>
              <button
                mat-stroked-button
                type="button"
                (click)="goBack()"
              >
                Volver
              </button>
            </div>
          </form>
        </article>

      </section>
    </div>
  </div>
} @else {
  <p class="empty">Usuario no encontrado.</p>
  <button mat-stroked-button (click)="goBack()">Volver</button>
}
