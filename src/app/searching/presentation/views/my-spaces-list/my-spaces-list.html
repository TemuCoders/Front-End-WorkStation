<div class="page-container">
  <app-sidebar></app-sidebar>

  <main class="main-content">
    <div class="page-header">
      <h1 class="page-title">Mis Espacios de Trabajo</h1>
      <button class="btn btn-primary" (click)="createNewSpace()">
        <mat-icon>add</mat-icon> Crear Nuevo Espacio
      </button>
    </div>

    @if (loading()) {
      <div class="loading-container">
        <p>Cargando tus espacios...</p>
      </div>
    } @else if (mySpaces().length === 0) {
      <div class="empty-state">
        <h2>No tienes espacios registrados</h2>
        <p>Comienza creando tu primer espacio de trabajo</p>
        <button class="btn btn-primary" (click)="createNewSpace()">
          <mat-icon>add_box</mat-icon> Crear Primer Espacio
        </button>
      </div>
    } @else {

      <div class="spaces-grid">
        @for (space of mySpaces(); track space.spaceId) {
          <div class="space-card">

            @if (editingSpaceId() === space.spaceId) {
              <div class="edit-mode">
                <h3>Editando: {{ space.name }}</h3>

                <div class="form-group">
                  <label>Nombre:</label>
                  <input type="text" [(ngModel)]="editForm().name" class="form-input">
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Tipo:</label>
                    <select [(ngModel)]="editForm().spaceType" class="form-input">
                      <option value="Oficina Privada">Oficina Privada</option>
                      <option value="Sala de Reuniones">Sala de Reuniones</option>
                      <option value="Escritorio Dedicado">Escritorio Dedicado</option>
                      <option value="Espacio Coworking">Espacio Coworking</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label>Capacidad:</label>
                    <input type="number" [(ngModel)]="editForm().capacity" class="form-input">
                  </div>

                  <div class="form-group">
                    <label>Precio/día (S/):</label>
                    <input type="number" [(ngModel)]="editForm().price" class="form-input">
                  </div>
                </div>

                <div class="form-group">
                  <label>Descripción:</label>
                  <textarea [(ngModel)]="editForm().description" class="form-textarea" rows="3"></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Calle:</label>
                    <input type="text" [(ngModel)]="editForm().street" class="form-input">
                  </div>

                  <div class="form-group">
                    <label>Número:</label>
                    <input type="text" [(ngModel)]="editForm().streetNumber" class="form-input">
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Ciudad:</label>
                    <input type="text" [(ngModel)]="editForm().city" class="form-input">
                  </div>

                  <div class="form-group">
                    <label>Código Postal:</label>
                    <input type="text" [(ngModel)]="editForm().postalCode" class="form-input">
                  </div>
                </div>

                <div class="form-group checkbox-group">
                  <label>
                    <input type="checkbox" [(ngModel)]="editForm().available">
                    Disponible para reservas
                  </label>
                </div>

                <div class="edit-actions">
                  <button class="btn btn-success" (click)="saveEdit(space.spaceId)">
                    <mat-icon>check</mat-icon> Guardar
                  </button>
                  <button class="btn btn-secondary" (click)="cancelEdit()">
                    <mat-icon>close</mat-icon> Cancelar
                  </button>
                </div>
              </div>

            } @else {
              <div class="airbnb-card">

                <div class="space-image">
                  <img [src]="getMainImage(space.images)" [alt]="space.name">
                  <span class="status-badge" [class.available]="space.available">
                    {{ space.available ? 'Disponible' : 'No disponible' }}
                  </span>
                </div>

                <div class="space-info">
                  <div class="space-title">
                    <h3>{{ space.name }}</h3>
                    <span class="space-type">{{ space.spaceType }}</span>
                  </div>

                  <div class="space-meta">
                    <span><mat-icon>location_on</mat-icon> {{ space.address }}</span>
                    <span><mat-icon>people</mat-icon> {{ space.capacity }} personas</span>
                  </div>

                  <p class="space-description">{{ space.description }}</p>

                  <div class="space-price">
                    <span>S/ {{ space.price }}</span> <small>/ día</small>
                  </div>

                  <div class="space-actions">
                    <button class="btn-action" (click)="startEdit(space)">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button class="btn-action" (click)="toggleAvailability(space)">
                      <mat-icon>
                        {{ space.available ? 'lock' : 'lock_open' }}
                      </mat-icon>
                    </button>
                    <button class="btn-action delete" (click)="deleteSpace(space.spaceId, space.name)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </div>

              </div>
            }
          </div>
        }
      </div>
    }
  </main>
</div>