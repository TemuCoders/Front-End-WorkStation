<div class="page-container">
  <app-sidebar></app-sidebar>

  <main class="main-content">
    <div class="page-header">
      <h1 class="page-title">Mis Espacios de Trabajo</h1>
      <button class="btn btn-primary" (click)="createNewSpace()">
        ‚ûï Crear Nuevo Espacio
      </button>
    </div>

    @if (loading()) {
      <div class="loading-container">
        <p>Cargando tus espacios...</p>
      </div>
    } @else if (mySpaces().length === 0) {
      <div class="empty-state">
        <h2>No tienes espacios registrados</h2>
        <p>Comienza creando tu primer espacio de trabajo</p>
        <button class="btn btn-primary" (click)="createNewSpace()">
          ‚ûï Crear Primer Espacio
        </button>
      </div>
    } @else {
      <div class="spaces-list">
        @for (space of mySpaces(); track space.spaceId) {
          <div class="space-card">
            @if (editingSpaceId() === space.spaceId) {
              <!-- MODO EDICI√ìN -->
              <div class="edit-mode">
                <h3>Editando: {{ space.name }}</h3>
                
                <div class="form-group">
                  <label>Nombre:</label>
                  <input 
                    type="text" 
                    [(ngModel)]="editForm().name"
                    class="form-input">
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Tipo:</label>
                    <select [(ngModel)]="editForm().spaceType" class="form-input">
                      <option value="Oficina Privada">Oficina Privada</option>
                      <option value="Sala de Reuniones">Sala de Reuniones</option>
                      <option value="Escritorio Dedicado">Escritorio Dedicado</option>
                      <option value="Espacio Coworking">Espacio Coworking</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label>Capacidad:</label>
                    <input 
                      type="number" 
                      [(ngModel)]="editForm().capacity"
                      class="form-input"
                      min="1">
                  </div>

                  <div class="form-group">
                    <label>Precio/d√≠a (S/):</label>
                    <input 
                      type="number" 
                      [(ngModel)]="editForm().price"
                      class="form-input"
                      min="0">
                  </div>
                </div>

                <div class="form-group">
                  <label>Descripci√≥n:</label>
                  <textarea 
                    [(ngModel)]="editForm().description"
                    class="form-textarea"
                    rows="3"></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Calle:</label>
                    <input 
                      type="text" 
                      [(ngModel)]="editForm().street"
                      class="form-input">
                  </div>

                  <div class="form-group">
                    <label>N√∫mero:</label>
                    <input 
                      type="text" 
                      [(ngModel)]="editForm().streetNumber"
                      class="form-input">
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label>Ciudad:</label>
                    <input 
                      type="text" 
                      [(ngModel)]="editForm().city"
                      class="form-input">
                  </div>

                  <div class="form-group">
                    <label>C√≥digo Postal:</label>
                    <input 
                      type="text" 
                      [(ngModel)]="editForm().postalCode"
                      class="form-input">
                  </div>
                </div>

                <div class="form-group">
                  <label>
                    <input 
                      type="checkbox" 
                      [(ngModel)]="editForm().available">
                    Disponible para reservas
                  </label>
                </div>

                <div class="edit-actions">
                  <button class="btn btn-success" (click)="saveEdit(space.spaceId)">
                    ‚úì Guardar
                  </button>
                  <button class="btn btn-secondary" (click)="cancelEdit()">
                    ‚úï Cancelar
                  </button>
                </div>
              </div>
            } @else {
              <!-- MODO VISTA -->
              <div class="space-image">
                <img [src]="getMainImage(space.images)" [alt]="space.name">
                <span class="status-badge" [class.available]="space.available">
                  {{ space.available ? 'Disponible' : 'No disponible' }}
                </span>
              </div>

              <div class="space-info">
                <h3>{{ space.name }}</h3>
                
                <div class="space-details">
                  <span class="detail-item">üìç {{ space.address }}</span>
                  <span class="detail-item">üè¢ {{ space.spaceType }}</span>
                  <span class="detail-item">üë• {{ space.capacity }} personas</span>
                  <span class="detail-item">üí∞ S/ {{ space.price }}/d√≠a</span>
                </div>

                <p class="space-description">{{ space.description }}</p>

                <div class="space-actions">
                  <button class="btn btn-sm btn-primary" (click)="startEdit(space)">
                    ‚úèÔ∏è Editar
                  </button>
                  
                  <button 
                    class="btn btn-sm" 
                    [class.btn-warning]="space.available"
                    [class.btn-success]="!space.available"
                    (click)="toggleAvailability(space)">
                    {{ space.available ? 'üîí Desactivar' : 'üîì Activar' }}
                  </button>

                  <button class="btn btn-sm btn-info" (click)="viewSpaceBookings(space.spaceId)">
                    üìÖ Ver Reservas
                  </button>

                  <button class="btn btn-sm btn-danger" (click)="deleteSpace(space.spaceId, space.name)">
                    üóëÔ∏è Eliminar
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  </main>
</div>